# AI Music Maker（V0）PRD — Web（PC+移动自适应）

版本：V0-Web  
目标：用“上传/录音一段哼唱或清唱”让任何人生成可分享的成品音乐，并沉淀个人作品库。  
端：**Web（PC+移动自适应）**，后续再扩展 App（不影响后端与数据模型）。

---

## 1. 产品定位
一句话：把你的一段哼唱/清唱，变成可保存、可分享的成品音乐。

V0 核心能力
- 输入：上传音频或浏览器录音（不设硬上限；强烈建议选重点片段）
- 生成：一次生成 A/B 两个完整版本
- 选择：试听对比，选主版本沉淀为“我的作品”
- 作品库：可回听、可分享
- 可选 V0.5：Agent（选段推荐、参数编排、A/B 解释与一键迭代）
- 可选 V1：歌词卡视频（确认音乐后再生成）

V0 不做
- 保留用户原声/换声
- 复杂 MV

---

## 2. 成功指标
北极星：7 日内有效作品数（被用户选为主版本并保存的 Track）

漏斗：Create 到达 → 提交生成 → 生成成功（A/B 可播）→ 选主版本 → 分享 / 再生成

质量指标（为调优服务）
- input_similarity（输入片段 vs 成品）
- ab_diversity（A/B 差异度）
- audio_quality（静音/削波/音量）

---

## 3. 端与兼容策略（Web）
### 3.1 响应式断点
- Mobile：<= 768（单列滚动）
- Desktop：> 768（两列布局：左输入/右预览或结果）

### 3.2 浏览器录音注意
- iOS Safari / 微信内置浏览器：录音与编码差异大，V0 建议：
  - 主流浏览器优先支持（Chrome/Edge/Safari）
  - 录音输出统一走后端转码（FFmpeg）兜底
- 自动播放限制：分享页默认“点击播放”

---

## 4. 关键链路（V0）
1) Create：录音或上传音频  
2) （推荐）选择重点片段（10–30 秒，或使用整段）  
3) 输入风格（必填）+ 可选文本（歌词/主题）+ 可选高级设置  
4) 生成：一次生成 A/B 两条完整音频  
5) Result：试听对比，选主版本  
6) Library：保存到作品库，生成分享链接（Share）

---

## 5. 页面与功能（V0）
### 5.1 WEB-Create（创作页）
必填
- 声音素材：录音/上传（二选一）
- 风格：标签选择 + 支持手打自定义

可选
- 歌词/主题：多行文本（可空）
- 重点片段：推荐选择（不选也可生成，默认后端自动选）

高级设置（折叠）
- 不想要的风格（exclude）
- 成品形态：女声/男声/纯伴奏
- 文本模式：按我写的来 / 系统帮我整理
- 两滑杆：创作张力、风格锁定

### 5.2 WEB-Generating（生成中）
- 阶段条与说明：可离开，完成后在作品库可见
- 失败态：重试/返回

### 5.3 WEB-Result（结果页）
- A/B 两个版本卡片：单实例播放；可配置默认试听 12s
- 选主版本（必须）
- 三按钮：分享这首 / 再来一组 / （V1）生成歌词卡视频
- 未选主版本点击分享/视频：弹窗拦截 + 快捷选 A/B

### 5.4 WEB-Library（作品库）
- 列表：封面/标题/日期/播放
- 详情：播放、复制分享链接、删除（软删）

### 5.5 WEB-Share（分享页）
- 播放器 + 标题 + 标签
- CTA：回到站内创作（同域链接）

---

## 6. 人声策略（现阶段约束）
V0 以“参考你的旋律/节奏”生成成品，不承诺保留原声。UI 禁止出现“保留我的人声”的强承诺。

---

## 7. 可观测（V0.5 强烈建议）
- trace_id = track_id
- steps：audio_check/audio_analyze/segment_pick/compose_params/music_generate/ab_eval（可选 video_generate）
- scores：input_similarity/audio_quality/ab_diversity/chosen_variant
- 以《Agent 可观测规范（Langfuse，Web）》为准（独立工程标准文档）

---

## 8. 音乐生成供应商策略

### 8.1 多供应商架构

为降低单一供应商风险、覆盖更多场景，系统支持多供应商并存：

| 供应商 | 模式 | 输入 | 状态 | 优先级 |
|--------|------|------|------|--------|
| Minimax | Text-to-Music | 歌词 + 风格描述 | ✅ 已确认 | 主力（文字模式） |
| Suno | Audio-to-Music | 用户音频 + 风格 | ⬜ 待确认 | 备选（音频模式） |

### 8.2 生成模式定义

**模式 A：Text-to-Music（文字生成）**
- 输入：歌词（必填）+ 风格描述（必填）
- 输出：完整音乐
- 供应商：Minimax
- 适用场景：用户有明确歌词创意，无需录音

**模式 B：Audio-to-Music（音频生成）**
- 输入：用户音频（哼唱/清唱）+ 风格描述
- 输出：基于输入旋律的完整音乐
- 供应商：Suno（待确认）
- 适用场景：用户有旋律想法，通过哼唱表达

### 8.3 前端模式切换

Create 页第一步提供模式选择：
- **录音/上传模式**（Audio-to-Music）：现有流程
- **纯文字模式**（Text-to-Music）：跳过录音，直接输入歌词

### 8.4 供应商 API 规范

#### 8.4.1 Minimax Music Generation API

**基本信息**
| 项目 | 值 |
|------|-----|
| Base URL | `https://api.minimaxi.com` |
| Endpoint | `POST /v1/music_generation` |
| Model | `music-2.0` |
| 认证 | Bearer Token（API Key） |
| 调用方式 | 同步（直接返回结果） |

**请求参数**
| 参数 | 必填 | 类型 | 说明 |
|------|------|------|------|
| `model` | ✅ | string | 固定 `music-2.0` |
| `prompt` | ✅ | string | 音乐描述（风格/情绪/场景），10-2000 字符 |
| `lyrics` | ✅ | string | 歌词，支持结构标签 `[Verse]` `[Chorus]` `[Bridge]` 等 |
| `output_format` | ❌ | string | `url`（推荐）或 `hex`，默认 `hex` |
| `audio_setting` | ❌ | object | 采样率/比特率/格式配置 |

**请求示例**
```json
{
  "model": "music-2.0",
  "prompt": "独立民谣,忧郁,内省,渴望,独自漫步,咖啡馆",
  "lyrics": "[verse]\n街灯微亮晚风轻抚\n影子拉长独自漫步\n[chorus]\n推开木门香气弥漫\n熟悉的角落陌生人看",
  "output_format": "url",
  "audio_setting": {
    "sample_rate": 44100,
    "bitrate": 256000,
    "format": "mp3"
  }
}
```

**响应字段**
| 字段 | 说明 |
|------|------|
| `data.audio` | 音频数据（hex 编码）或 URL |
| `data.status` | 状态：1=生成中，2=完成 |
| `extra_info.music_duration` | 音乐时长（毫秒） |
| `base_resp.status_code` | 0=成功，其他为错误码 |

**错误码**
| 码 | 说明 |
|----|------|
| 0 | 成功 |
| 1002 | 触发限流 |
| 1004 | 鉴权失败 |
| 1008 | 余额不足 |
| 1026 | 内容敏感 |
| 2013 | 参数异常 |

**A/B 版本策略**
Minimax 单次调用只返回一个版本，需调用两次生成 A/B：
- 第一次调用：生成版本 A
- 第二次调用：相同参数，生成版本 B
- 成本：2x 单次费用

**参数映射**
| 前端参数 | Minimax 参数 | 映射方式 |
|----------|--------------|----------|
| `style` | `prompt` | 直接传递 |
| `lyrics` | `lyrics` | 直接传递 |
| `voiceType` | `prompt` | 追加到描述："女声演唱" / "男声演唱" / "纯伴奏" |
| `excludeStyles` | `prompt` | 追加到描述："避免xxx风格" |
| `tension` | - | 不支持 |
| `styleLock` | - | 不支持 |
| `segment` | - | 不适用（无音频输入） |

#### 8.4.2 Suno API（待确认）

**状态**：待确认供应商

**需确认事项**
- [ ] API 接入方式（官方 / 第三方代理）
- [ ] 是否支持 Audio-to-Music
- [ ] 请求/响应格式
- [ ] 是否原生支持 A/B 双版本
- [ ] 支持的参数列表
- [ ] 计费方式

**预期能力**
| 能力 | 预期 |
|------|------|
| 音频输入 | ✅ 支持用户上传音频 |
| 风格指定 | ✅ 支持 |
| 片段选择 | ⬜ 待确认 |
| A/B 版本 | ⬜ 待确认 |

### 8.5 供应商选择逻辑

```
用户选择模式
    ├── 文字模式 → Minimax
    └── 音频模式 → Suno（待实现）
                   └── 降级：提示用户使用文字模式
```

### 8.6 环境变量配置

```bash
# Minimax
MINIMAX_API_KEY=your_api_key
MINIMAX_API_BASE_URL=https://api.minimaxi.com

# Suno（待确认）
SUNO_API_KEY=
SUNO_API_BASE_URL=
```

---

